{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _JSON$stringify from \"@babel/runtime-corejs2/core-js/json/stringify\";\nimport _objectSpread from \"@babel/runtime-corejs2/helpers/esm/objectSpread\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport config from \"../../config\";\nimport { checkSession } from \"../user/checkSession\";\nexport default\n/*#__PURE__*/\n(function () {\n  var _ref = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee(table, data, options) {\n    var opt, gql, headers, session, postData, i, response, json;\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            opt = _objectSpread({}, {\n              useSession: true,\n              debug: false,\n              primaryKey: \"id\"\n            }, options);\n            gql = \"mutation create($data:\".concat(table, \"_insert_input!) {\\n    insert_\").concat(table, \"(\\n      objects: [$data]\\n    ) {\\n      returning {\\n        \").concat(opt.primaryKey, \"\\n      }\\n    }\\n  }\");\n\n            if (opt && opt.debug) {\n              console.log(gql, data);\n            }\n\n            headers = {\n              \"Content-Type\": \"application/json\"\n            };\n\n            if (!opt.useSession) {\n              _context.next = 11;\n              break;\n            }\n\n            _context.next = 7;\n            return checkSession();\n\n          case 7:\n            session = _context.sent;\n            headers[\"X-Hasura-Session-Id\"] = session.id;\n\n            if (session) {\n              _context.next = 11;\n              break;\n            }\n\n            return _context.abrupt(\"return\", false);\n\n          case 11:\n            postData = {};\n            _context.t0 = _regeneratorRuntime.keys(data);\n\n          case 13:\n            if ((_context.t1 = _context.t0()).done) {\n              _context.next = 20;\n              break;\n            }\n\n            i = _context.t1.value;\n\n            if (!i.endsWith(\"_aggregate\")) {\n              _context.next = 17;\n              break;\n            }\n\n            return _context.abrupt(\"continue\", 13);\n\n          case 17:\n            postData[i] = data[i];\n            _context.next = 13;\n            break;\n\n          case 20:\n            _context.next = 22;\n            return fetch(config.url, {\n              method: \"POST\",\n              body: _JSON$stringify({\n                operationName: \"create\",\n                query: gql,\n                variables: {\n                  data: postData\n                }\n              }),\n              headers: headers\n            });\n\n          case 22:\n            response = _context.sent;\n            _context.next = 25;\n            return response.json();\n\n          case 25:\n            json = _context.sent;\n\n            if (!(response.status !== 200)) {\n              _context.next = 30;\n              break;\n            }\n\n            if (!(json && json.errors && json.errors[0] && json.errors[0].message)) {\n              _context.next = 29;\n              break;\n            }\n\n            throw \"\\n(Create Record Failed) \".concat(json.errors[0].message, \" \\n\\nGraphQL Mutation:\\n\").concat(gql, \"\\n\\nData: \\n\").concat(_JSON$stringify(data, null, 2).replace(/\"/gi, \"'\"), \"\\n        \").trim();\n\n          case 29:\n            return _context.abrupt(\"return\", null);\n\n          case 30:\n            return _context.abrupt(\"return\", json.data[\"insert_\".concat(table)].returning[0].id);\n\n          case 31:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n\n  return function (_x, _x2, _x3) {\n    return _ref.apply(this, arguments);\n  };\n})();","map":{"version":3,"sources":["/Users/riz/Documents/edumatis-web/libs/queries/crud/createRecord.ts"],"names":["config","checkSession","table","data","options","opt","useSession","debug","primaryKey","gql","console","log","headers","session","id","postData","i","endsWith","fetch","url","method","body","operationName","query","variables","response","json","status","errors","message","replace","trim","returning"],"mappings":";;;;AAAA,OAAOA,MAAP;AACA,SAASC,YAAT;AAQA;AAAA;AAAA;AAAA;AAAA;AAAA,2BAAe,iBAAOC,KAAP,EAAsBC,IAAtB,EAAiCC,OAAjC;AAAA;AAAA;AAAA;AAAA;AAAA;AACPC,YAAAA,GADO,qBAER;AAAEC,cAAAA,UAAU,EAAE,IAAd;AAAoBC,cAAAA,KAAK,EAAE,KAA3B;AAAkCC,cAAAA,UAAU,EAAE;AAA9C,aAFQ,EAGRJ,OAHQ;AAKPK,YAAAA,GALO,mCAKwBP,KALxB,2CAMFA,KANE,4EAULG,GAAG,CAACG,UAVC;;AAcb,gBAAIH,GAAG,IAAIA,GAAG,CAACE,KAAf,EAAsB;AACpBG,cAAAA,OAAO,CAACC,GAAR,CAAYF,GAAZ,EAAiBN,IAAjB;AACD;;AACGS,YAAAA,OAjBS,GAiBM;AACjB,8BAAgB;AADC,aAjBN;;AAAA,iBAoBTP,GAAG,CAACC,UApBK;AAAA;AAAA;AAAA;;AAAA;AAAA,mBAqBWL,YAAY,EArBvB;;AAAA;AAqBLY,YAAAA,OArBK;AAsBXD,YAAAA,OAAO,CAAC,qBAAD,CAAP,GAAiCC,OAAO,CAACC,EAAzC;;AAtBW,gBAuBND,OAvBM;AAAA;AAAA;AAAA;;AAAA,6CAwBF,KAxBE;;AAAA;AA4BPE,YAAAA,QA5BO,GA4BS,EA5BT;AAAA,mDA6BCZ,IA7BD;;AAAA;AAAA;AAAA;AAAA;AAAA;;AA6BJa,YAAAA,CA7BI;;AAAA,iBA8BPA,CAAC,CAACC,QAAF,CAAW,YAAX,CA9BO;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAiCXF,YAAAA,QAAQ,CAACC,CAAD,CAAR,GAAcb,IAAI,CAACa,CAAD,CAAlB;AAjCW;AAAA;;AAAA;AAAA;AAAA,mBAoCoBE,KAAK,CAAClB,MAAM,CAACmB,GAAR,EAAa;AACjDC,cAAAA,MAAM,EAAE,MADyC;AAEjDC,cAAAA,IAAI,EAAE,gBAAe;AACnBC,gBAAAA,aAAa,EAAE,QADI;AAEnBC,gBAAAA,KAAK,EAAEd,GAFY;AAGnBe,gBAAAA,SAAS,EAAE;AACTrB,kBAAAA,IAAI,EAAEY;AADG;AAHQ,eAAf,CAF2C;AASjDH,cAAAA,OAAO,EAAPA;AATiD,aAAb,CApCzB;;AAAA;AAoCPa,YAAAA,QApCO;AAAA;AAAA,mBA+CMA,QAAQ,CAACC,IAAT,EA/CN;;AAAA;AA+CPA,YAAAA,IA/CO;;AAAA,kBAgDTD,QAAQ,CAACE,MAAT,KAAoB,GAhDX;AAAA;AAAA;AAAA;;AAAA,kBAiDPD,IAAI,IAAIA,IAAI,CAACE,MAAb,IAAuBF,IAAI,CAACE,MAAL,CAAY,CAAZ,CAAvB,IAAyCF,IAAI,CAACE,MAAL,CAAY,CAAZ,EAAeC,OAjDjD;AAAA;AAAA;AAAA;;AAAA,kBAkDH,mCACaH,IAAI,CAACE,MAAL,CAAY,CAAZ,EAAeC,OAD5B,qCAIVpB,GAJU,yBAOV,gBAAeN,IAAf,EAAqB,IAArB,EAA2B,CAA3B,EAA8B2B,OAA9B,CAAsC,KAAtC,EAA6C,GAA7C,CAPU,gBAQFC,IARE,EAlDG;;AAAA;AAAA,6CA4DJ,IA5DI;;AAAA;AAAA,6CA8DNL,IAAI,CAACvB,IAAL,kBAAoBD,KAApB,GAA6B8B,SAA7B,CAAuC,CAAvC,EAA0ClB,EA9DpC;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAf;;AAAA;AAAA;AAAA;AAAA","sourcesContent":["import config from \"@app/libs/config\";\nimport { checkSession } from \"../user/checkSession\";\n\ninterface opts {\n  useSession?: boolean;\n  debug?: boolean;\n  primaryKey?: string;\n}\n\nexport default async (table: string, data: any, options?: opts) => {\n  const opt = {\n    ...{ useSession: true, debug: false, primaryKey: \"id\" },\n    ...options\n  };\n  const gql = `mutation create($data:${table}_insert_input!) {\n    insert_${table}(\n      objects: [$data]\n    ) {\n      returning {\n        ${opt.primaryKey}\n      }\n    }\n  }`;\n  if (opt && opt.debug) {\n    console.log(gql, data);\n  }\n  let headers: any = {\n    \"Content-Type\": \"application/json\"\n  };\n  if (opt.useSession) {\n    const session = await checkSession();\n    headers[\"X-Hasura-Session-Id\"] = session.id;\n    if (!session) {\n      return false;\n    }\n  }\n\n  const postData: any = {};\n  for (let i in data) {\n    if (i.endsWith(\"_aggregate\")) {\n      continue;\n    }\n    postData[i] = data[i];\n  }\n\n  const response: Response = await fetch(config.url, {\n    method: \"POST\",\n    body: JSON.stringify({\n      operationName: \"create\",\n      query: gql,\n      variables: {\n        data: postData\n      }\n    }),\n    headers\n  });\n  const json = await response.json();\n  if (response.status !== 200) {\n    if (json && json.errors && json.errors[0] && json.errors[0].message) {\n      throw `\n(Create Record Failed) ${json.errors[0].message} \n\nGraphQL Mutation:\n${gql}\n\nData: \n${JSON.stringify(data, null, 2).replace(/\"/gi, \"'\")}\n        `.trim();\n    }\n    return null;\n  }\n  return json.data[`insert_${table}`].returning[0].id;\n};\n"]},"metadata":{},"sourceType":"module"}