{"ast":null,"code":"import _parseInt from \"@babel/runtime-corejs2/core-js/parse-int\";\nimport _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nvar __jsx = React.createElement;\nimport query from \"../../../libs/queries/crud/query\";\nimport { checkSession } from \"../../../libs/queries/user/checkSession\";\nimport UIButton from \"../../../libs/ui/UIButton\";\nimport UIFieldText from \"../../../libs/ui/UIFieldText\";\nimport UIImage from \"../../../libs/ui/UIImage\";\nimport { RootStore } from \"../../../libs/stores/RootStore\";\nimport { observer, useObservable } from \"mobx-react-lite\";\nimport React, { useEffect } from \"react\";\nimport { Text, View, ScrollView } from \"react-native-web\";\nimport { createNavigateTo } from \"../../../libs/nav/NavContainer\";\nimport UIHead from \"../../../libs/ui/UIHead\";\nexport default observer(function (_ref) {\n  var navigation = _ref.navigation;\n  var navigateTo = createNavigateTo(navigation);\n  var data = useObservable({\n    sekolah_id: \"\",\n    nsa: \"\",\n    password: \"\"\n  });\n  var meta = useObservable({\n    sekolah: \"\",\n    murid: \"\",\n    loading: true\n  });\n  useEffect(function () {\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee() {\n      var session;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return checkSession();\n\n            case 2:\n              session = _context.sent;\n\n              if (!(session && session.murid && session.murid.nsa)) {\n                _context.next = 6;\n                break;\n              }\n\n              if (session.murid.nsa === \"admin\") {\n                navigation.replace(\"Admin\");\n              } else {\n                navigation.replace(\"Siswa\");\n              }\n\n              return _context.abrupt(\"return\");\n\n            case 6:\n              meta.loading = false;\n\n            case 7:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }))();\n  }, []);\n\n  if (meta.loading) {\n    return __jsx(View, {\n      style: {\n        flex: 1,\n        alignItems: \"center\",\n        justifyContent: \"center\",\n        backgroundColor: \"#fff\"\n      }\n    }, __jsx(Text, null, \"Loading...\"));\n  }\n\n  return __jsx(ScrollView, {\n    style: {\n      backgroundColor: \"#fff\"\n    }\n  }, __jsx(View, {\n    style: {\n      alignSelf: \"center\",\n      flexBasis: \"100%\",\n      minWidth: 400\n    }\n  }, __jsx(UIHead, {\n    navigation: navigation,\n    title: \"Menu Awal\",\n    onBack: function onBack() {\n      navigateTo(\"Home\");\n    }\n  }), __jsx(UIImage, {\n    source: require(\"../imgs/logo-edumatis_a.png\"),\n    mobileStyle: {\n      height: 150,\n      marginBottom: -10\n    },\n    style: {\n      width: 200,\n      alignSelf: \"center\",\n      marginTop: 10\n    }\n  }), __jsx(Text, {\n    style: {\n      fontSize: 14,\n      fontWeight: 'bold',\n      alignSelf: 'center',\n      color: '#808080',\n      marginBottom: 10\n    }\n  }, \"Aman . Mudah . Handal . Hemat\"), __jsx(UIFieldText, {\n    label: \"ID Sekolah\",\n    sublabel: meta.sekolah,\n    value: data.sekolah_id,\n    setValue: function setValue(value) {\n      return data.sekolah_id = value;\n    },\n    onBlur:\n    /*#__PURE__*/\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee2() {\n      var res;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.prev = 0;\n              _context2.next = 3;\n              return query(\"sekolah\", [\"nama_sekolah\"], {\n                where: {\n                  id: _parseInt(data.sekolah_id)\n                },\n                useSession: false\n              });\n\n            case 3:\n              res = _context2.sent;\n\n              if (res && res.nama_sekolah) {\n                meta.sekolah = res.nama_sekolah;\n              } else {\n                meta.sekolah = \"Sekolah tidak ditemukan\";\n              }\n\n              _context2.next = 9;\n              break;\n\n            case 7:\n              _context2.prev = 7;\n              _context2.t0 = _context2[\"catch\"](0);\n\n            case 9:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[0, 7]]);\n    }))\n  }), __jsx(UIFieldText, {\n    label: \"Nomor Induk / NSA\",\n    sublabel: meta.murid,\n    value: data.nsa,\n    setValue: function setValue(value) {\n      return data.nsa = value;\n    },\n    onBlur:\n    /*#__PURE__*/\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee3() {\n      var res;\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              _context3.next = 2;\n              return query(\"murid\", [\"nama_murid\"], {\n                where: {\n                  sekolah_id: _parseInt(data.sekolah_id),\n                  nsa: data.nsa\n                },\n                useSession: false\n              });\n\n            case 2:\n              res = _context3.sent;\n\n              if (res && res.nama_murid) {\n                meta.murid = \"Nama: \" + res.nama_murid;\n              } else {\n                meta.murid = \"Nomor Induk tidak ditemukan\";\n              }\n\n            case 4:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    }))\n  }), __jsx(UIFieldText, {\n    type: \"password\",\n    label: \"Password\",\n    value: data.password,\n    setValue: function setValue(value) {\n      return data.password = value;\n    }\n  }), __jsx(UIButton, {\n    onPress:\n    /*#__PURE__*/\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee4() {\n      var session;\n      return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              meta.loading = true;\n              _context4.next = 3;\n              return RootStore.session.login(data.sekolah_id, data.nsa, data.password);\n\n            case 3:\n              session = _context4.sent;\n\n              if (!(session && session.murid && session.murid.nsa)) {\n                _context4.next = 7;\n                break;\n              }\n\n              if (session.murid.nsa === \"admin\") {\n                navigation.replace(\"Admin\");\n              } else {\n                navigation.replace(\"Siswa\");\n              }\n\n              return _context4.abrupt(\"return\");\n\n            case 7:\n              meta.loading = false;\n              location.reload();\n\n            case 9:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee4);\n    })),\n    style: {\n      alignItems: 'center'\n    }\n  }, \"Login\")));\n});","map":null,"metadata":{},"sourceType":"module"}