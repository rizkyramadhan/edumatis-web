{"ast":null,"code":"import _parseInt from \"@babel/runtime-corejs2/core-js/parse-int\";\nimport _Object$keys from \"@babel/runtime-corejs2/core-js/object/keys\";\nimport _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nvar _jsxFileName = \"/Users/riz/Documents/edumatis-web/pages/app/screens/admin/Report.tsx\";\nvar __jsx = React.createElement;\nimport StackNav from \"../../../../libs/nav/StackNav\";\nimport rawQuery from \"../../../../libs/queries/crud/rawQuery\";\nimport UIBody from \"../../../../libs/ui/UIBody\";\nimport UIButton from \"../../../../libs/ui/UIButton\";\nimport UICol from \"../../../../libs/ui/UICol\";\nimport UIContainer from \"../../../../libs/ui/UIContainer\";\nimport UIHead from \"../../../../libs/ui/UIHead\";\nimport UIList from \"../../../../libs/ui/UIList\";\nimport UIListItem from \"../../../../libs/ui/UIListItem\";\nimport UIRow from \"../../../../libs/ui/UIRow\";\nimport RelativeTime from 'dayjs/plugin/relativeTime';\nimport _ from 'lodash';\nimport get from 'lodash.get';\nimport { observer, useObservable } from 'mobx-react-lite';\nimport React, { useEffect } from 'react';\nimport { ScrollView, View } from \"react-native-web\";\n\nvar dayjs = require('dayjs');\n\ndayjs.extend(RelativeTime);\nvar Report = observer(function (_ref) {\n  var navigation = _ref.navigation;\n  var data = useObservable({\n    listRaw: [],\n    filter: {\n      kewajiban: '',\n      kelas: ''\n    },\n    loading: true\n  });\n  var kelasList = {\n    '-Semua Kelas-': true\n  };\n  var kewajibanList = {\n    '-Semua Kewajiban-': true\n  };\n  var list = data.listRaw.filter(function (row) {\n    var match = true;\n\n    var kelas = _.get(row, 'murid.kelas_murids[0].kelas.nama_kelas');\n\n    var kewajiban = _.get(row, 'kewajiban.nama_kewajiban');\n\n    if (kelas && !kelasList[kelas]) {\n      kelasList[kelas] = true;\n    }\n\n    if (kewajiban && !kewajibanList[kewajiban]) {\n      kewajibanList[kewajiban] = true;\n    }\n\n    if (data.filter.kewajiban) {\n      if (kewajiban !== data.filter.kewajiban) {\n        match = false;\n      }\n    }\n\n    if (data.filter.kelas && data.filter.kelas !== '-Semua Kelas-') {\n      if (kelas.trim() !== data.filter.kelas.trim()) {\n        match = false;\n      }\n    }\n\n    console.log(data.filter.kelas);\n    return match;\n  });\n  useEffect(function () {\n    var fetch =\n    /*#__PURE__*/\n    function () {\n      var _ref2 = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee() {\n        var result;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.next = 2;\n                return rawQuery(\"{\\n        transaksi(order_by: {tstamp: asc}) {\\n          id\\n          status\\n          tstamp\\n          amount: detail(path:\\\"amount\\\")\\n          detail(path:\\\"status\\\")\\n          paid(path:\\\"status\\\")\\n          murid {\\n            id\\n            nama_murid\\n            nsa\\n            kelas_murids {\\n              kelas {\\n                nama_kelas\\n              }\\n            }\\n          }\\n          kewajiban {\\n            nama_kewajiban\\n          }\\n        }\\n      }\\n      \");\n\n              case 2:\n                result = _context.sent;\n                data.listRaw = result.transaksi;\n                data.loading = false;\n\n              case 5:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      return function fetch() {\n        return _ref2.apply(this, arguments);\n      };\n    }();\n\n    fetch();\n  }, []);\n  return __jsx(UIContainer, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 92\n    },\n    __self: this\n  }, __jsx(UIHead, {\n    navigation: navigation,\n    title: \"Laporan Transaksi\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 93\n    },\n    __self: this\n  }, __jsx(UIButton, {\n    size: \"small\",\n    onPress: function onPress() {\n      var parse = function parse(e) {\n        var isRoot = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n        return _Object$keys(e).map(function (r) {\n          var row = e[r];\n          if (isRoot) return r;\n          return row;\n        }).join(',');\n      };\n\n      var csvList = [];\n      list.map(function (e) {\n        var res = {};\n\n        for (var i in e) {\n          var row = e[i];\n\n          if (typeof row === 'object' && row !== null) {\n            if (row.nama_kewajiban) res['nama_kewajiban'] = row.nama_kewajiban;\n\n            if (row.nama_murid) {\n              res['nama_murid'] = _.get(row, 'nama_murid');\n              res['nsa'] = _.get(row, 'nsa');\n              res['kelas'] = _.get(row, 'kelas_murids.0.kelas.nama_kelas');\n            }\n          } else res[i] = row;\n        }\n\n        csvList.push(res);\n      });\n      var csvContent = 'data:text/csv;charset=utf-8,' + parse(csvList[0], true) + '\\n' + csvList.map(function (e) {\n        return parse(e);\n      }).join('\\n');\n      var encodedUri = encodeURI(csvContent);\n      var link = document.createElement('a');\n      link.setAttribute('href', encodedUri);\n      link.setAttribute('download', 'report.csv');\n      document.body.appendChild(link); // Required for FF\n\n      link.click(); // This will download the data file named \"my_data.csv\".\n    },\n    style: {\n      flexDirection: 'column',\n      alignItems: 'center',\n      width: 150\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 94\n    },\n    __self: this\n  }, \"Download CSV\")), __jsx(UIBody, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 147\n    },\n    __self: this\n  }, __jsx(UIRow, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 148\n    },\n    __self: this\n  }, __jsx(\"select\", {\n    value: data.filter.kelas,\n    onChange: function onChange(e) {\n      data.filter.kelas = e.target.value;\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 149\n    },\n    __self: this\n  }, _Object$keys(kelasList).map(function (i, idx) {\n    return __jsx(\"option\", {\n      value: i,\n      key: idx,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 156\n      },\n      __self: this\n    }, i);\n  })), __jsx(\"select\", {\n    value: data.filter.kewajiban,\n    onChange: function onChange(e) {\n      data.filter.kewajiban = e.target.value;\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 161\n    },\n    __self: this\n  }, _Object$keys(kewajibanList).map(function (i, idx) {\n    return __jsx(\"option\", {\n      value: i,\n      key: idx,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 168\n      },\n      __self: this\n    }, i);\n  }))), __jsx(ScrollView, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 174\n    },\n    __self: this\n  }, __jsx(View, {\n    style: {\n      flexDirection: 'row',\n      paddingLeft: 25\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 175\n    },\n    __self: this\n  }, __jsx(UIRow, {\n    style: {\n      width: 40\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 181\n    },\n    __self: this\n  }, __jsx(UICol, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 182\n    },\n    __self: this\n  }, \"No.\")), __jsx(UIRow, {\n    style: {\n      width: 200\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 184\n    },\n    __self: this\n  }, __jsx(UICol, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 185\n    },\n    __self: this\n  }, \"Nama\")), __jsx(UIRow, {\n    style: {\n      width: 100\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 187\n    },\n    __self: this\n  }, __jsx(UICol, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 188\n    },\n    __self: this\n  }, \"Kelas\")), __jsx(UIRow, {\n    style: {\n      width: 240\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 190\n    },\n    __self: this\n  }, __jsx(UICol, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 195\n    },\n    __self: this\n  }, \"Kewajiban\")), __jsx(UIRow, {\n    style: {\n      width: 100\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 197\n    },\n    __self: this\n  }, __jsx(UICol, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 202\n    },\n    __self: this\n  }, \"Biaya (Rp)\")), __jsx(UIRow, {\n    style: {\n      width: 100\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 204\n    },\n    __self: this\n  }, __jsx(UICol, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 209\n    },\n    __self: this\n  }, \"Status\")), __jsx(UIRow, {\n    style: {\n      width: 150\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 211\n    },\n    __self: this\n  }, __jsx(UICol, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 216\n    },\n    __self: this\n  }, \"Waktu\")), __jsx(UIRow, {\n    style: {\n      width: 150\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 218\n    },\n    __self: this\n  }, __jsx(UICol, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 219\n    },\n    __self: this\n  }, \"Log\"))), __jsx(UIList, {\n    data: list,\n    loading: data.loading,\n    render: function render(list) {\n      var item = list.item;\n      var tgl = dayjs(item.tstamp);\n      var fromday = tgl.fromNow();\n      var kelas = get(item, 'murid.kelas_murids[0].kelas.nama_kelas') || 'Semua Kelas';\n\n      var nominal = _parseInt(item.amount || item.nominal);\n\n      var status = (item.paid || item.detail || item.status).toLowerCase();\n      if (status === 'paid') status = 'success';\n      return __jsx(UIListItem, {\n        onPress: function onPress() {\n          navigation.navigate('TransaksiDetail', {\n            item: item\n          });\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 242\n        },\n        __self: this\n      }, __jsx(View, {\n        style: {\n          flexDirection: 'row'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 249\n        },\n        __self: this\n      }, __jsx(UIRow, {\n        style: {\n          width: 40\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 250\n        },\n        __self: this\n      }, __jsx(UICol, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 251\n        },\n        __self: this\n      }, item.id)), __jsx(UIRow, {\n        style: {\n          width: 200\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 253\n        },\n        __self: this\n      }, __jsx(UICol, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 254\n        },\n        __self: this\n      }, item.murid.nama_murid)), __jsx(UIRow, {\n        style: {\n          width: 100\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 256\n        },\n        __self: this\n      }, __jsx(UICol, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 257\n        },\n        __self: this\n      }, kelas)), __jsx(UIRow, {\n        style: {\n          width: 240\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 259\n        },\n        __self: this\n      }, __jsx(UICol, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 260\n        },\n        __self: this\n      }, item.kewajiban.nama_kewajiban)), __jsx(UIRow, {\n        style: {\n          width: 100\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 262\n        },\n        __self: this\n      }, __jsx(UICol, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 263\n        },\n        __self: this\n      }, (nominal || 0).toLocaleString())), __jsx(UIRow, {\n        style: {\n          width: 100\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 265\n        },\n        __self: this\n      }, __jsx(UICol, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 266\n        },\n        __self: this\n      }, status)), __jsx(UIRow, {\n        style: {\n          width: 150\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 268\n        },\n        __self: this\n      }, __jsx(UICol, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 269\n        },\n        __self: this\n      }, tgl.format('DD MMM YYYY - hh.mm'))), __jsx(UIRow, {\n        style: {\n          width: 150\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 271\n        },\n        __self: this\n      }, __jsx(UICol, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 272\n        },\n        __self: this\n      }, fromday))));\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 222\n    },\n    __self: this\n  }))));\n});\nexport default StackNav({\n  Report: {\n    screen: Report\n  }\n});","map":{"version":3,"sources":["/Users/riz/Documents/edumatis-web/pages/app/screens/admin/Report.tsx"],"names":["StackNav","rawQuery","UIBody","UIButton","UICol","UIContainer","UIHead","UIList","UIListItem","UIRow","RelativeTime","_","get","observer","useObservable","React","useEffect","ScrollView","View","dayjs","require","extend","Report","navigation","data","listRaw","filter","kewajiban","kelas","loading","kelasList","kewajibanList","list","row","match","trim","console","log","fetch","result","transaksi","parse","e","isRoot","map","r","join","csvList","res","i","nama_kewajiban","nama_murid","push","csvContent","encodedUri","encodeURI","link","document","createElement","setAttribute","body","appendChild","click","flexDirection","alignItems","width","target","value","idx","paddingLeft","item","tgl","tstamp","fromday","fromNow","nominal","amount","status","paid","detail","toLowerCase","navigate","id","murid","toLocaleString","format","screen"],"mappings":"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","sourcesContent":["import StackNav from '@app/libs/nav/StackNav';\nimport rawQuery from '@app/libs/queries/crud/rawQuery';\nimport UIBody from '@app/libs/ui/UIBody';\nimport UIButton from '@app/libs/ui/UIButton';\nimport UICol from '@app/libs/ui/UICol';\nimport UIContainer from '@app/libs/ui/UIContainer';\nimport UIHead from '@app/libs/ui/UIHead';\nimport UIList from '@app/libs/ui/UIList';\nimport UIListItem from '@app/libs/ui/UIListItem';\nimport UIRow from '@app/libs/ui/UIRow';\nimport RelativeTime from 'dayjs/plugin/relativeTime';\nimport _ from 'lodash';\nimport get from 'lodash.get';\nimport { observer, useObservable } from 'mobx-react-lite';\nimport React, { useEffect } from 'react';\nimport { ScrollView, View } from 'react-native';\nconst dayjs = require('dayjs');\ndayjs.extend(RelativeTime);\nconst Report = observer(({ navigation }: any) => {\n  const data = useObservable({\n    listRaw: [],\n    filter: {\n      kewajiban: '',\n      kelas: ''\n    },\n\n    loading: true\n  });\n\n  const kelasList = { '-Semua Kelas-': true };\n  const kewajibanList = { '-Semua Kewajiban-': true };\n  const list = data.listRaw.filter((row: any) => {\n    let match = true;\n\n    const kelas = _.get(row, 'murid.kelas_murids[0].kelas.nama_kelas');\n    const kewajiban = _.get(row, 'kewajiban.nama_kewajiban');\n    if (kelas && !kelasList[kelas]) {\n      kelasList[kelas] = true;\n    }\n\n    if (kewajiban && !kewajibanList[kewajiban]) {\n      kewajibanList[kewajiban] = true;\n    }\n\n    if (data.filter.kewajiban) {\n      if (kewajiban !== data.filter.kewajiban) {\n        match = false;\n      }\n    }\n\n    if (data.filter.kelas && data.filter.kelas !== '-Semua Kelas-') {\n      if (kelas.trim() !== data.filter.kelas.trim()) {\n        match = false;\n      }\n    }\n    console.log(data.filter.kelas);\n\n    return match;\n  });\n  useEffect(() => {\n    let fetch = async () => {\n      const result = await rawQuery(`{\n        transaksi(order_by: {tstamp: asc}) {\n          id\n          status\n          tstamp\n          amount: detail(path:\"amount\")\n          detail(path:\"status\")\n          paid(path:\"status\")\n          murid {\n            id\n            nama_murid\n            nsa\n            kelas_murids {\n              kelas {\n                nama_kelas\n              }\n            }\n          }\n          kewajiban {\n            nama_kewajiban\n          }\n        }\n      }\n      `);\n      data.listRaw = result.transaksi;\n      data.loading = false;\n    };\n    fetch();\n  }, []);\n  return (\n    <UIContainer>\n      <UIHead navigation={navigation} title='Laporan Transaksi'>\n        <UIButton\n          size='small'\n          onPress={() => {\n            const parse = (e: any, isRoot = false) => {\n              return Object.keys(e)\n                .map(r => {\n                  const row = e[r] as any;\n                  if (isRoot) return r;\n                  return row;\n                })\n                .join(',');\n            };\n\n            const csvList: any = [];\n            list.map(e => {\n              const res: any = {};\n              for (let i in e) {\n                const row = e[i] as any;\n                if (typeof row === 'object' && row !== null) {\n                  if (row.nama_kewajiban)\n                    res['nama_kewajiban'] = row.nama_kewajiban;\n                  if (row.nama_murid) {\n                    res['nama_murid'] = _.get(row, 'nama_murid');\n                    res['nsa'] = _.get(row, 'nsa');\n                    res['kelas'] = _.get(\n                      row,\n                      'kelas_murids.0.kelas.nama_kelas'\n                    );\n                  }\n                } else res[i] = row;\n              }\n              csvList.push(res);\n            });\n\n            let csvContent =\n              'data:text/csv;charset=utf-8,' +\n              parse(csvList[0], true) +\n              '\\n' +\n              csvList.map((e: any) => parse(e)).join('\\n');\n\n            var encodedUri = encodeURI(csvContent);\n            var link = document.createElement('a');\n            link.setAttribute('href', encodedUri);\n            link.setAttribute('download', 'report.csv');\n            document.body.appendChild(link); // Required for FF\n\n            link.click(); // This will download the data file named \"my_data.csv\".\n          }}\n          style={{ flexDirection: 'column', alignItems: 'center', width: 150 }}\n        >\n          Download CSV\n        </UIButton>\n      </UIHead>\n      <UIBody>\n        <UIRow>\n          <select\n            value={data.filter.kelas}\n            onChange={e => {\n              data.filter.kelas = e.target.value;\n            }}\n          >\n            {Object.keys(kelasList).map((i, idx) => (\n              <option value={i} key={idx}>\n                {i}\n              </option>\n            ))}\n          </select>\n          <select\n            value={data.filter.kewajiban}\n            onChange={e => {\n              data.filter.kewajiban = e.target.value;\n            }}\n          >\n            {Object.keys(kewajibanList).map((i, idx) => (\n              <option value={i} key={idx}>\n                {i}\n              </option>\n            ))}\n          </select>\n        </UIRow>\n        <ScrollView>\n          <View\n            style={{\n              flexDirection: 'row',\n              paddingLeft: 25\n            }}\n          >\n            <UIRow style={{ width: 40 }}>\n              <UICol>No.</UICol>\n            </UIRow>\n            <UIRow style={{ width: 200 }}>\n              <UICol>Nama</UICol>\n            </UIRow>\n            <UIRow style={{ width: 100 }}>\n              <UICol>Kelas</UICol>\n            </UIRow>\n            <UIRow\n              style={{\n                width: 240\n              }}\n            >\n              <UICol>Kewajiban</UICol>\n            </UIRow>\n            <UIRow\n              style={{\n                width: 100\n              }}\n            >\n              <UICol>Biaya (Rp)</UICol>\n            </UIRow>\n            <UIRow\n              style={{\n                width: 100\n              }}\n            >\n              <UICol>Status</UICol>\n            </UIRow>\n            <UIRow\n              style={{\n                width: 150\n              }}\n            >\n              <UICol>Waktu</UICol>\n            </UIRow>\n            <UIRow style={{ width: 150 }}>\n              <UICol>Log</UICol>\n            </UIRow>\n          </View>\n          <UIList\n            data={list}\n            loading={data.loading}\n            render={(list: any) => {\n              const item = list.item;\n\n              const tgl = dayjs(item.tstamp);\n              const fromday = tgl.fromNow();\n              const kelas =\n                get(item, 'murid.kelas_murids[0].kelas.nama_kelas') ||\n                'Semua Kelas';\n              const nominal = parseInt(item.amount || item.nominal);\n              let status = (\n                item.paid ||\n                item.detail ||\n                item.status\n              ).toLowerCase();\n              if (status === 'paid') status = 'success';\n\n              return (\n                <UIListItem\n                  onPress={() => {\n                    navigation.navigate('TransaksiDetail', {\n                      item: item\n                    });\n                  }}\n                >\n                  <View style={{ flexDirection: 'row' }}>\n                    <UIRow style={{ width: 40 }}>\n                      <UICol>{item.id}</UICol>\n                    </UIRow>\n                    <UIRow style={{ width: 200 }}>\n                      <UICol>{item.murid.nama_murid}</UICol>\n                    </UIRow>\n                    <UIRow style={{ width: 100 }}>\n                      <UICol>{kelas}</UICol>\n                    </UIRow>\n                    <UIRow style={{ width: 240 }}>\n                      <UICol>{item.kewajiban.nama_kewajiban}</UICol>\n                    </UIRow>\n                    <UIRow style={{ width: 100 }}>\n                      <UICol>{(nominal || 0).toLocaleString()}</UICol>\n                    </UIRow>\n                    <UIRow style={{ width: 100 }}>\n                      <UICol>{status}</UICol>\n                    </UIRow>\n                    <UIRow style={{ width: 150 }}>\n                      <UICol>{tgl.format('DD MMM YYYY - hh.mm')}</UICol>\n                    </UIRow>\n                    <UIRow style={{ width: 150 }}>\n                      <UICol>{fromday}</UICol>\n                    </UIRow>\n                  </View>\n                </UIListItem>\n              );\n            }}\n          />\n        </ScrollView>\n      </UIBody>\n    </UIContainer>\n  );\n});\n\nexport default StackNav({\n  Report: { screen: Report }\n});\n"]},"metadata":{},"sourceType":"module"}