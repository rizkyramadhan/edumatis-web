{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nvar __jsx = React.createElement;\nimport UIBody from \"../../../../libs/ui/UIBody\";\nimport UIButton from \"../../../../libs/ui/UIButton\";\nimport UIContainer from \"../../../../libs/ui/UIContainer\";\nimport UIFieldText from \"../../../../libs/ui/UIFieldText\";\nimport UIHead from \"../../../../libs/ui/UIHead\";\nimport { observer, useObservable } from \"mobx-react-lite\";\nimport React from \"react\";\nimport { Text, Alert, Platform } from \"react-native-web\";\nimport { getSession } from \"../../../../libs/queries/user/getsetSession\";\nimport updateRecord from \"../../../../libs/queries/crud/updateRecord\";\nimport { hashPassword } from \"../../../../libs/queries/user/hashPassword\";\nexport default observer(function (_ref) {\n  var navigation = _ref.navigation;\n  var data = useObservable({\n    new1: \"\",\n    new2: \"\",\n    old: \"\",\n    loading: false\n  });\n  return __jsx(UIContainer, null, __jsx(UIHead, {\n    navigation: navigation,\n    title: \"Ubah Password\"\n  }), __jsx(UIBody, null, __jsx(UIFieldText, {\n    type: \"password\",\n    label: \"Password Lama\",\n    value: data.old,\n    setValue: function setValue(value) {\n      return data.old = value;\n    }\n  }), __jsx(UIFieldText, {\n    type: \"password\",\n    label: \"Password Baru\",\n    value: data.new1,\n    setValue: function setValue(value) {\n      return data.new1 = value;\n    }\n  }), __jsx(UIFieldText, {\n    type: \"password\",\n    label: \"Ulangi Password Baru\",\n    value: data.new2,\n    setValue: function setValue(value) {\n      return data.new2 = value;\n    }\n  }), data.loading ? __jsx(Text, null, \"Loading...\") : __jsx(UIButton, {\n    onPress:\n    /*#__PURE__*/\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee() {\n      var a, session, response, res;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              a = Platform.OS === \"web\" ? alert : Alert.alert;\n              _context.next = 3;\n              return getSession();\n\n            case 3:\n              session = _context.sent;\n\n              if (!(!data.new1 || !data.new2 || !data.old)) {\n                _context.next = 7;\n                break;\n              }\n\n              a(\"Mohon isi password dengan lengkap\");\n              return _context.abrupt(\"return\", false);\n\n            case 7:\n              if (!(data.new1 !== data.new2)) {\n                _context.next = 10;\n                break;\n              }\n\n              a(\"Password tidak sama \");\n              return _context.abrupt(\"return\", false);\n\n            case 10:\n              data.loading = true;\n              _context.next = 13;\n              return fetch(\"https://backend.cap.edumatis.id\", {\n                method: \"GET\",\n                headers: {\n                  \"Content-Type\": \"application/json\",\n                  \"X-Hasura-Username\": session.murid.nsa,\n                  \"X-Hasura-Password\": data.old,\n                  \"X-Hasura-Cid\": session.murid.sekolah_id + \"\"\n                }\n              });\n\n            case 13:\n              response = _context.sent;\n              _context.next = 16;\n              return response.json();\n\n            case 16:\n              res = _context.sent;\n              console.log(res, {\n                \"Content-Type\": \"application/json\",\n                \"X-Hasura-Username\": session.murid.nsa,\n                \"X-Hasura-Password\": data.old,\n                \"X-Hasura-Cid\": session.murid.sekolah_id + \"\"\n              });\n\n              if (!(res[\"X-Hasura-Role\"] !== \"anonymous\")) {\n                _context.next = 26;\n                break;\n              }\n\n              _context.next = 21;\n              return updateRecord(\"murid\", {\n                id: session.murid.id,\n                password: data.new1\n              });\n\n            case 21:\n              _context.next = 23;\n              return hashPassword(session.murid.id);\n\n            case 23:\n              a(\"Password berhasil di-ubah!\");\n              _context.next = 27;\n              break;\n\n            case 26:\n              a(\"Password lama salah\");\n\n            case 27:\n              data.loading = false;\n\n            case 28:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }))\n  }, \"Ubah Password\")));\n});","map":null,"metadata":{},"sourceType":"module"}