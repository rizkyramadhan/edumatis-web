{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nvar _jsxFileName = \"/Users/riz/Documents/edumatis-web/pages/app/screens/admin/EditProfile.tsx\";\nvar __jsx = React.createElement;\nimport UIBody from \"../../../../libs/ui/UIBody\";\nimport UIButton from \"../../../../libs/ui/UIButton\";\nimport UIContainer from \"../../../../libs/ui/UIContainer\";\nimport UIFieldText from \"../../../../libs/ui/UIFieldText\";\nimport UIHead from \"../../../../libs/ui/UIHead\";\nimport { observer, useObservable } from \"mobx-react-lite\";\nimport React from \"react\";\nimport { Text, Alert, Platform } from \"react-native-web\";\nimport { getSession } from \"../../../../libs/queries/user/getsetSession\";\nimport updateRecord from \"../../../../libs/queries/crud/updateRecord\";\nimport { hashPassword } from \"../../../../libs/queries/user/hashPassword\";\nexport default observer(function (_ref) {\n  var navigation = _ref.navigation;\n  var data = useObservable({\n    new1: \"\",\n    new2: \"\",\n    old: \"\",\n    loading: false\n  });\n  return __jsx(UIContainer, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 21\n    },\n    __self: this\n  }, __jsx(UIHead, {\n    navigation: navigation,\n    title: \"Ubah Password\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 22\n    },\n    __self: this\n  }), __jsx(UIBody, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 23\n    },\n    __self: this\n  }, __jsx(UIFieldText, {\n    type: \"password\",\n    label: \"Password Lama\",\n    value: data.old,\n    setValue: function setValue(value) {\n      return data.old = value;\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 24\n    },\n    __self: this\n  }), __jsx(UIFieldText, {\n    type: \"password\",\n    label: \"Password Baru\",\n    value: data.new1,\n    setValue: function setValue(value) {\n      return data.new1 = value;\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 31\n    },\n    __self: this\n  }), __jsx(UIFieldText, {\n    type: \"password\",\n    label: \"Ulangi Password Baru\",\n    value: data.new2,\n    setValue: function setValue(value) {\n      return data.new2 = value;\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 38\n    },\n    __self: this\n  }), data.loading ? __jsx(Text, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 46\n    },\n    __self: this\n  }, \"Loading...\") : __jsx(UIButton, {\n    onPress:\n    /*#__PURE__*/\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee() {\n      var a, session, response, res;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              a = Platform.OS === \"web\" ? alert : Alert.alert;\n              _context.next = 3;\n              return getSession();\n\n            case 3:\n              session = _context.sent;\n\n              if (!(!data.new1 || !data.new2 || !data.old)) {\n                _context.next = 7;\n                break;\n              }\n\n              a(\"Mohon isi password dengan lengkap\");\n              return _context.abrupt(\"return\", false);\n\n            case 7:\n              if (!(data.new1 !== data.new2)) {\n                _context.next = 10;\n                break;\n              }\n\n              a(\"Password tidak sama \");\n              return _context.abrupt(\"return\", false);\n\n            case 10:\n              data.loading = true;\n              _context.next = 13;\n              return fetch(\"https://backend.cap.edumatis.id\", {\n                method: \"GET\",\n                headers: {\n                  \"Content-Type\": \"application/json\",\n                  \"X-Hasura-Username\": session.nama_sekolah.nsa,\n                  \"X-Hasura-Password\": data.old,\n                  \"X-Hasura-Cid\": session.nama_sekolah + \"\"\n                }\n              });\n\n            case 13:\n              response = _context.sent;\n              _context.next = 16;\n              return response.json();\n\n            case 16:\n              res = _context.sent;\n              console.log(res, {\n                \"Content-Type\": \"application/json\",\n                \"X-Hasura-Username\": session.nama_sekolah.nsa,\n                \"X-Hasura-Password\": data.old,\n                \"X-Hasura-Cid\": session.nama_sekolah + \"\"\n              });\n\n              if (!(res[\"X-Hasura-Role\"] !== \"anonymous\")) {\n                _context.next = 26;\n                break;\n              }\n\n              _context.next = 21;\n              return updateRecord(\"nama_sekolah\", {\n                id: session.nama_sekolah.id,\n                password: data.new1\n              });\n\n            case 21:\n              _context.next = 23;\n              return hashPassword(session.nama_sekolah.id);\n\n            case 23:\n              a(\"Password berhasil di-ubah!\");\n              _context.next = 27;\n              break;\n\n            case 26:\n              a(\"Password lama salah\");\n\n            case 27:\n              data.loading = false;\n\n            case 28:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    })),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 48\n    },\n    __self: this\n  }, \"Ubah Password\")));\n});","map":{"version":3,"sources":["/Users/riz/Documents/edumatis-web/pages/app/screens/admin/EditProfile.tsx"],"names":["UIBody","UIButton","UIContainer","UIFieldText","UIHead","observer","useObservable","React","Text","Alert","Platform","getSession","updateRecord","hashPassword","navigation","data","new1","new2","old","loading","value","a","OS","alert","session","fetch","method","headers","nama_sekolah","nsa","response","json","res","console","log","id","password"],"mappings":";;;;AAAA,OAAOA,MAAP;AACA,OAAOC,QAAP;AACA,OAAOC,WAAP;AACA,OAAOC,WAAP;AACA,OAAOC,MAAP;AACA,SAASC,QAAT,EAAmBC,aAAnB,QAAwC,iBAAxC;AACA,OAAOC,KAAP,MAAkB,OAAlB;AACA,SAASC,IAAT,EAAeC,KAAf,EAAsBC,QAAtB;AACA,SAASC,UAAT;AACA,OAAOC,YAAP;AACA,SAASC,YAAT;AAEA,eAAeR,QAAQ,CAAC,gBAAyB;AAAA,MAAtBS,UAAsB,QAAtBA,UAAsB;AAC/C,MAAMC,IAAI,GAAGT,aAAa,CAAC;AACzBU,IAAAA,IAAI,EAAE,EADmB;AAEzBC,IAAAA,IAAI,EAAE,EAFmB;AAGzBC,IAAAA,GAAG,EAAE,EAHoB;AAIzBC,IAAAA,OAAO,EAAE;AAJgB,GAAD,CAA1B;AAMA,SACE,MAAC,WAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE,MAAC,MAAD;AAAQ,IAAA,UAAU,EAAEL,UAApB;AAAgC,IAAA,KAAK,EAAC,eAAtC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADF,EAEE,MAAC,MAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE,MAAC,WAAD;AACE,IAAA,IAAI,EAAC,UADP;AAEE,IAAA,KAAK,EAAC,eAFR;AAGE,IAAA,KAAK,EAAEC,IAAI,CAACG,GAHd;AAIE,IAAA,QAAQ,EAAE,kBAACE,KAAD;AAAA,aAAoBL,IAAI,CAACG,GAAL,GAAWE,KAA/B;AAAA,KAJZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADF,EAQE,MAAC,WAAD;AACE,IAAA,IAAI,EAAC,UADP;AAEE,IAAA,KAAK,EAAC,eAFR;AAGE,IAAA,KAAK,EAAEL,IAAI,CAACC,IAHd;AAIE,IAAA,QAAQ,EAAE,kBAACI,KAAD;AAAA,aAAoBL,IAAI,CAACC,IAAL,GAAYI,KAAhC;AAAA,KAJZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IARF,EAeE,MAAC,WAAD;AACE,IAAA,IAAI,EAAC,UADP;AAEE,IAAA,KAAK,EAAC,sBAFR;AAGE,IAAA,KAAK,EAAEL,IAAI,CAACE,IAHd;AAIE,IAAA,QAAQ,EAAE,kBAACG,KAAD;AAAA,aAAoBL,IAAI,CAACE,IAAL,GAAYG,KAAhC;AAAA,KAJZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAfF,EAsBGL,IAAI,CAACI,OAAL,GACC,MAAC,IAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBADD,GAGC,MAAC,QAAD;AACE,IAAA,OAAO;AAAA;AAAA;AAAA;AAAA,6BAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AACDE,cAAAA,CADC,GACGX,QAAQ,CAACY,EAAT,KAAgB,KAAhB,GAAwBC,KAAxB,GAAgCd,KAAK,CAACc,KADzC;AAAA;AAAA,qBAGeZ,UAAU,EAHzB;;AAAA;AAGDa,cAAAA,OAHC;;AAAA,oBAKH,CAACT,IAAI,CAACC,IAAN,IAAc,CAACD,IAAI,CAACE,IAApB,IAA4B,CAACF,IAAI,CAACG,GAL/B;AAAA;AAAA;AAAA;;AAMLG,cAAAA,CAAC,CAAC,mCAAD,CAAD;AANK,+CAOE,KAPF;;AAAA;AAAA,oBASHN,IAAI,CAACC,IAAL,KAAcD,IAAI,CAACE,IAThB;AAAA;AAAA;AAAA;;AAULI,cAAAA,CAAC,CAAC,sBAAD,CAAD;AAVK,+CAWE,KAXF;;AAAA;AAaPN,cAAAA,IAAI,CAACI,OAAL,GAAe,IAAf;AAbO;AAAA,qBAe0BM,KAAK,CACpC,iCADoC,EAEpC;AACEC,gBAAAA,MAAM,EAAE,KADV;AAEEC,gBAAAA,OAAO,EAAE;AACP,kCAAgB,kBADT;AAEP,uCAAqBH,OAAO,CAACI,YAAR,CAAqBC,GAFnC;AAGP,uCAAqBd,IAAI,CAACG,GAHnB;AAIP,kCAAgBM,OAAO,CAACI,YAAR,GAAuB;AAJhC;AAFX,eAFoC,CAf/B;;AAAA;AAeDE,cAAAA,QAfC;AAAA;AAAA,qBA2BSA,QAAQ,CAACC,IAAT,EA3BT;;AAAA;AA2BHC,cAAAA,GA3BG;AA4BPC,cAAAA,OAAO,CAACC,GAAR,CAAYF,GAAZ,EAAiB;AACf,gCAAgB,kBADD;AAEf,qCAAqBR,OAAO,CAACI,YAAR,CAAqBC,GAF3B;AAGf,qCAAqBd,IAAI,CAACG,GAHX;AAIf,gCAAgBM,OAAO,CAACI,YAAR,GAAuB;AAJxB,eAAjB;;AA5BO,oBAkCHI,GAAG,CAAC,eAAD,CAAH,KAAyB,WAlCtB;AAAA;AAAA;AAAA;;AAAA;AAAA,qBAmCCpB,YAAY,CAAC,cAAD,EAAiB;AACjCuB,gBAAAA,EAAE,EAAEX,OAAO,CAACI,YAAR,CAAqBO,EADQ;AAEjCC,gBAAAA,QAAQ,EAAErB,IAAI,CAACC;AAFkB,eAAjB,CAnCb;;AAAA;AAAA;AAAA,qBAuCCH,YAAY,CAACW,OAAO,CAACI,YAAR,CAAqBO,EAAtB,CAvCb;;AAAA;AAwCLd,cAAAA,CAAC,CAAC,4BAAD,CAAD;AAxCK;AAAA;;AAAA;AA0CLA,cAAAA,CAAC,CAAC,qBAAD,CAAD;;AA1CK;AA6CPN,cAAAA,IAAI,CAACI,OAAL,GAAe,KAAf;;AA7CO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAF,EADT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBAzBJ,CAFF,CADF;AAmFD,CA1FsB,CAAvB","sourcesContent":["import UIBody from \"@app/libs/ui/UIBody\";\nimport UIButton from \"@app/libs/ui/UIButton\";\nimport UIContainer from \"@app/libs/ui/UIContainer\";\nimport UIFieldText from \"@app/libs/ui/UIFieldText\";\nimport UIHead from \"@app/libs/ui/UIHead\";\nimport { observer, useObservable } from \"mobx-react-lite\";\nimport React from \"react\";\nimport { Text, Alert, Platform } from \"react-native\";\nimport { getSession } from \"@app/libs/queries/user/getsetSession\";\nimport updateRecord from \"@app/libs/queries/crud/updateRecord\";\nimport { hashPassword } from \"@app/libs/queries/user/hashPassword\";\n\nexport default observer(({ navigation }: any) => {\n  const data = useObservable({\n    new1: \"\",\n    new2: \"\",\n    old: \"\",\n    loading: false\n  });\n  return (\n    <UIContainer>\n      <UIHead navigation={navigation} title=\"Ubah Password\" />\n      <UIBody>\n        <UIFieldText\n          type=\"password\"\n          label=\"Password Lama\"\n          value={data.old}\n          setValue={(value: string) => (data.old = value)}\n        />\n\n        <UIFieldText\n          type=\"password\"\n          label=\"Password Baru\"\n          value={data.new1}\n          setValue={(value: string) => (data.new1 = value)}\n        />\n\n        <UIFieldText\n          type=\"password\"\n          label=\"Ulangi Password Baru\"\n          value={data.new2}\n          setValue={(value: string) => (data.new2 = value)}\n        />\n\n        {data.loading ? (\n          <Text>Loading...</Text>\n        ) : (\n          <UIButton\n            onPress={async () => {\n              const a = Platform.OS === \"web\" ? alert : Alert.alert;\n\n              const session = await getSession();\n\n              if (!data.new1 || !data.new2 || !data.old) {\n                a(\"Mohon isi password dengan lengkap\");\n                return false;\n              }\n              if (data.new1 !== data.new2) {\n                a(\"Password tidak sama \");\n                return false;\n              }\n              data.loading = true;\n\n              const response: Response = await fetch(\n                \"https://backend.cap.edumatis.id\",\n                {\n                  method: \"GET\",\n                  headers: {\n                    \"Content-Type\": \"application/json\",\n                    \"X-Hasura-Username\": session.nama_sekolah.nsa,\n                    \"X-Hasura-Password\": data.old,\n                    \"X-Hasura-Cid\": session.nama_sekolah + \"\"\n                  }\n                }\n              );\n              let res = await response.json();\n              console.log(res, {\n                \"Content-Type\": \"application/json\",\n                \"X-Hasura-Username\": session.nama_sekolah.nsa,\n                \"X-Hasura-Password\": data.old,\n                \"X-Hasura-Cid\": session.nama_sekolah + \"\"\n              });\n              if (res[\"X-Hasura-Role\"] !== \"anonymous\") {\n                await updateRecord(\"nama_sekolah\", {\n                  id: session.nama_sekolah.id,\n                  password: data.new1\n                });\n                await hashPassword(session.nama_sekolah.id);\n                a(\"Password berhasil di-ubah!\");\n              } else {\n                a(\"Password lama salah\");\n              }\n\n              data.loading = false;\n            }}\n          >\n            Ubah Password\n          </UIButton>\n        )}\n      </UIBody>\n    </UIContainer>\n  );\n});\n"]},"metadata":{},"sourceType":"module"}