{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _Object$keys from \"@babel/runtime-corejs2/core-js/object/keys\";\nimport _JSON$stringify from \"@babel/runtime-corejs2/core-js/json/stringify\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nvar _jsxFileName = \"/Users/riz/Documents/edumatis-web/pages/app/screens/siswa/Kewajiban/Kewajiban.tsx\";\nvar __jsx = React.createElement;\nimport StackNav from \"../../../../../libs/nav/StackNav\";\nimport rawQuery from \"../../../../../libs/queries/crud/rawQuery\";\nimport { getSession } from \"../../../../../libs/queries/user/getsetSession\";\nimport UIBody from \"../../../../../libs/ui/UIBody\";\nimport UIContainer from \"../../../../../libs/ui/UIContainer\";\nimport UIHead from \"../../../../../libs/ui/UIHead\";\nimport UIList from \"../../../../../libs/ui/UIList\";\nimport UIListItem from \"../../../../../libs/ui/UIListItem\";\nimport dayjs from \"dayjs\";\nimport { observer, useObservable } from \"mobx-react-lite\";\nimport React from \"react\";\nimport { Text, View } from \"react-native-web\";\nimport KewajibanDetail from \"./KewajibanDetail\";\nvar Kewajiban = observer(function (_ref) {\n  var navigation = _ref.navigation;\n  var data = useObservable({\n    list: [],\n    loading: true\n  });\n  return __jsx(UIContainer, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 21\n    },\n    __self: this\n  }, __jsx(UIHead, {\n    title: \"Kewajiban bulan ini\",\n    navigation: navigation,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 22\n    },\n    __self: this\n  }), __jsx(UIBody, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 23\n    },\n    __self: this\n  }, __jsx(UIList, {\n    data: data.list,\n    loading: data.loading,\n    render: function render(list) {\n      var item = list.item;\n      return __jsx(UIListItem, {\n        onPress: function onPress() {\n          navigation.navigate(\"KewajibanDetail\", {\n            item: item\n          });\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 30\n        },\n        __self: this\n      }, __jsx(View, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 37\n        },\n        __self: this\n      }, __jsx(Text, {\n        style: {\n          fontSize: 15,\n          fontWeight: \"bold\",\n          color: \"#555\"\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 38\n        },\n        __self: this\n      }, item.nama_kewajiban), __jsx(Text, {\n        style: {\n          fontSize: 14\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 43\n        },\n        __self: this\n      }, \"Rp \", item.nominal.toLocaleString(), \" (\", item.status, \")\")), __jsx(View, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 47\n        },\n        __self: this\n      }, __jsx(Text, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 48\n        },\n        __self: this\n      }, item.tipe_pembayaran)));\n    },\n    reload:\n    /*#__PURE__*/\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee() {\n      var session, kelasRaw, kelas, monthStart, monthEnd, result;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return getSession();\n\n            case 2:\n              session = _context.sent;\n              _context.next = 5;\n              return rawQuery(\"{\\n              kelas_murid(where: {murid_id: {_eq: \".concat(session.murid.id, \"}}) {\\n                kelas_id\\n              }\\n            }\"));\n\n            case 5:\n              kelasRaw = _context.sent;\n\n              if (!(kelasRaw && kelasRaw.kelas_murid && kelasRaw.kelas_murid.length > 0)) {\n                _context.next = 14;\n                break;\n              }\n\n              kelas = kelasRaw.kelas_murid.map(function (k) {\n                return k.kelas_id.toString();\n              });\n              monthStart = dayjs().startOf(\"month\").subtract(1, \"day\").format(\"YYYY-MM-DD\");\n              monthEnd = dayjs().endOf(\"month\").add(1, \"day\").format(\"YYYY-MM-DD\");\n              _context.next = 12;\n              return rawQuery(\"{\\n                kewajiban(order_by: [{tipe_pembayaran: asc}, {id: asc}], \\n                  where: {kelas: {_has_keys_any: \".concat(_JSON$stringify(kelas), \"}}) {\\n                  id\\n                  nama_kewajiban\\n                  nominal\\n                  tipe_pembayaran\\n                  kelas\\n                  transaksi(\\n                    where: {\\n                      kewajiban: {\\n                        _or:[\\n                          {_and:[\\n                            {tipe_pembayaran:{_eq:\\\"Bulanan\\\"}},\\n                            {transaksi: {\\n                               _and:[\\n                                {tstamp: {_gte: \\\"\").concat(monthStart, \"\\\"}},\\n                                {tstamp: {_lte: \\\"\").concat(monthEnd, \"\\\"}},\\n                              ] \\n                            }}\\n                          ]},\\n                          {tipe_pembayaran:{_eq:\\\"Insidentil\\\"}}\\n                        ]\\n                      }\\n                    }\\n                  ) {\\n                    id\\n                    status\\n                    tstamp\\n                    detail\\n                  }\\n                }  \\n              }\"));\n\n            case 12:\n              result = _context.sent;\n              data.list = result.kewajiban.map(function (item) {\n                _Object$keys(item.kelas).forEach(function (i) {\n                  var k = item.kelas[i];\n\n                  if (kelas.indexOf(k.id + \"\") >= 0 && k.nominal !== undefined) {\n                    item.nominal = k.nominal * 1;\n                  }\n\n                  k.murid.forEach(function (m) {\n                    if (m && session.murid && m.id === session.murid.id) {\n                      if (m.nominal !== undefined) {\n                        item.nominal = m.nominal * 1;\n                      }\n                    }\n                  });\n                });\n\n                item.status = \"Belum Lunas\";\n                item.transaksi.forEach(function (t) {\n                  if (t.paid === \"success\") {\n                    item.status = \"Lunas\";\n                  }\n                });\n                return item;\n              });\n\n            case 14:\n              data.loading = false;\n\n            case 15:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    })),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 24\n    },\n    __self: this\n  })));\n});\nexport default StackNav({\n  Kewajiban: {\n    screen: Kewajiban\n  },\n  KewajibanDetail: {\n    screen: KewajibanDetail\n  }\n});","map":{"version":3,"sources":["/Users/riz/Documents/edumatis-web/pages/app/screens/siswa/Kewajiban/Kewajiban.tsx"],"names":["StackNav","rawQuery","getSession","UIBody","UIContainer","UIHead","UIList","UIListItem","dayjs","observer","useObservable","React","Text","View","KewajibanDetail","Kewajiban","navigation","data","list","loading","item","navigate","fontSize","fontWeight","color","nama_kewajiban","nominal","toLocaleString","status","tipe_pembayaran","session","murid","id","kelasRaw","kelas_murid","length","kelas","map","k","kelas_id","toString","monthStart","startOf","subtract","format","monthEnd","endOf","add","result","kewajiban","forEach","i","indexOf","undefined","m","transaksi","t","paid","screen"],"mappings":"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","sourcesContent":["import StackNav from \"@app/libs/nav/StackNav\";\nimport rawQuery from \"@app/libs/queries/crud/rawQuery\";\nimport { getSession } from \"@app/libs/queries/user/getsetSession\";\nimport UIBody from \"@app/libs/ui/UIBody\";\nimport UIContainer from \"@app/libs/ui/UIContainer\";\nimport UIHead from \"@app/libs/ui/UIHead\";\nimport UIList from \"@app/libs/ui/UIList\";\nimport UIListItem from \"@app/libs/ui/UIListItem\";\nimport dayjs from \"dayjs\";\nimport { observer, useObservable } from \"mobx-react-lite\";\nimport React from \"react\";\nimport { Text, View } from \"react-native\";\nimport KewajibanDetail from \"./KewajibanDetail\";\n\nconst Kewajiban = observer(({ navigation }: any) => {\n  const data = useObservable({\n    list: [],\n    loading: true\n  });\n  return (\n    <UIContainer>\n      <UIHead title=\"Kewajiban bulan ini\" navigation={navigation} />\n      <UIBody>\n        <UIList\n          data={data.list}\n          loading={data.loading}\n          render={(list: any) => {\n            const item = list.item;\n            return (\n              <UIListItem\n                onPress={() => {\n                  navigation.navigate(\"KewajibanDetail\", {\n                    item: item\n                  });\n                }}\n              >\n                <View>\n                  <Text\n                    style={{ fontSize: 15, fontWeight: \"bold\", color: \"#555\" }}\n                  >\n                    {item.nama_kewajiban}\n                  </Text>\n                  <Text style={{ fontSize: 14 }}>\n                    Rp {item.nominal.toLocaleString()} ({item.status})\n                  </Text>\n                </View>\n                <View>\n                  <Text>{item.tipe_pembayaran}</Text>\n                </View>\n              </UIListItem>\n            );\n          }}\n          reload={async () => {\n            const session = await getSession();\n            const kelasRaw = await rawQuery(`{\n              kelas_murid(where: {murid_id: {_eq: ${session.murid.id}}}) {\n                kelas_id\n              }\n            }`);\n\n            if (\n              kelasRaw &&\n              kelasRaw.kelas_murid &&\n              kelasRaw.kelas_murid.length > 0\n            ) {\n              const kelas = kelasRaw.kelas_murid.map((k: any) => {\n                return k.kelas_id.toString();\n              });\n              const monthStart = dayjs()\n                .startOf(\"month\")\n                .subtract(1, \"day\")\n                .format(\"YYYY-MM-DD\");\n              const monthEnd = dayjs()\n                .endOf(\"month\")\n                .add(1, \"day\")\n                .format(\"YYYY-MM-DD\");\n\n              const result = await rawQuery(\n                `{\n                kewajiban(order_by: [{tipe_pembayaran: asc}, {id: asc}], \n                  where: {kelas: {_has_keys_any: ${JSON.stringify(kelas)}}}) {\n                  id\n                  nama_kewajiban\n                  nominal\n                  tipe_pembayaran\n                  kelas\n                  transaksi(\n                    where: {\n                      kewajiban: {\n                        _or:[\n                          {_and:[\n                            {tipe_pembayaran:{_eq:\"Bulanan\"}},\n                            {transaksi: {\n                               _and:[\n                                {tstamp: {_gte: \"${monthStart}\"}},\n                                {tstamp: {_lte: \"${monthEnd}\"}},\n                              ] \n                            }}\n                          ]},\n                          {tipe_pembayaran:{_eq:\"Insidentil\"}}\n                        ]\n                      }\n                    }\n                  ) {\n                    id\n                    status\n                    tstamp\n                    detail\n                  }\n                }  \n              }`\n              );\n              data.list = result.kewajiban.map((item: any) => {\n                Object.keys(item.kelas).forEach((i: any) => {\n                  const k = item.kelas[i];\n                  if (\n                    kelas.indexOf(k.id + \"\") >= 0 &&\n                    k.nominal !== undefined\n                  ) {\n                    item.nominal = k.nominal * 1;\n                  }\n                  k.murid.forEach((m: any) => {\n                    if (m && session.murid && m.id === session.murid.id) {\n                      if (m.nominal !== undefined) {\n                        item.nominal = m.nominal * 1;\n                      }\n                    }\n                  });\n                }); \n\n                item.status = \"Belum Lunas\";\n                item.transaksi.forEach((t: any) => {\n                  if (t.paid === \"success\") {\n                    item.status = \"Lunas\";\n                  }\n                });\n\n                return item;\n              });\n            }\n\n            data.loading = false;\n          }}\n        />\n      </UIBody>\n    </UIContainer>\n  );\n});\n\nexport default StackNav({\n  Kewajiban: { screen: Kewajiban },\n  KewajibanDetail: { screen: KewajibanDetail }\n});\n"]},"metadata":{},"sourceType":"module"}